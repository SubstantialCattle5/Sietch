#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Check if Go is installed
if ! command -v go >/dev/null 2>&1; then
    echo "âŒ Go is not installed or not in PATH"
    exit 1
fi

# Format check
echo "ğŸ“ Checking Go formatting..."
if [ -n "$(go fmt ./...)" ]; then
    echo "âŒ Code is not properly formatted. Please run 'make fmt' or 'go fmt ./...'"
    exit 1
fi
echo "âœ… Code formatting is correct"

# Go vet
echo "ğŸ” Running go vet..."
if ! make vet; then
    echo "âŒ go vet found issues. Please fix them before committing."
    exit 1
fi
echo "âœ… go vet passed"

# Lint check (if golangci-lint is available)
if command -v golangci-lint >/dev/null 2>&1; then
    echo "ğŸ§¹ Running golangci-lint..."
    if ! make lint; then
        echo "âŒ Linting failed. Please fix the issues before committing."
        echo "ğŸ’¡ Run 'make lint' to see detailed errors"
        exit 1
    fi
    echo "âœ… Linting passed"
else
    echo "âš ï¸  golangci-lint not found, skipping lint checks"
    echo "ğŸ’¡ Install golangci-lint for better code quality checks"
fi

# Unit tests
echo "ğŸ§ª Running unit tests..."
if ! make test-unit; then
    echo "âŒ Unit tests failed. Please fix failing tests before committing."
    exit 1
fi
echo "âœ… Unit tests passed"

echo "ğŸ‰ All pre-commit checks passed!"
